# report

### Данный скрипт позволяет сформировать кастомный отчет по отделу продаж с помощью REST API Битрикс24.

**Механизм работы**:
1. Руководитель отдела продаж указывает начальную и конечную дату, на которую необходимо сформировать отчет. 
2. На основании указанных дат происходит фильтрация посредством REST API Битрикс24 по сделкам и делам.
3. Результат выполнения: таблица, которая показывает количество сделок на каждом сотруднике, количество сделок без дел (не запланированы события в будущем), сколько было завершено дел в указанном промежутке, сколько дел просрочено в указанном промежутке. Также, расчитывается система мотивации для сотрудника по формуле: (Сколько дел всего было закрыто в указанном промежутке - просроченные дела - сделки без дел) * $1.

Решение может работать как на облачных, так и коробочных Битрикс24. 

**Как запустить**:
1. report.php, report.html и auth.php необходимо разместить на хостинге с поддержкой SSL.
2. В разделе "Разработчикам" необходимо создать входящий вебхук с правами на CRM (crm), Пользователи (user). Подробнее как создать входящий / исходящий вебхук: [Ссылки на документацию 1С-Битрикс](https://github.com/thnik911/report/blob/main/README.md#%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8-%D0%BD%D0%B0-%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%B0%D1%86%D0%B8%D1%8E-1%D1%81-%D0%B1%D0%B8%D1%82%D1%80%D0%B8%D0%BA%D1%81).
3. Полученный "Вебхук для вызова rest api" прописать в auth.php.
4. В строке 62 скрипта report.php необходимо указать подразделение, в котором работают сотрудники отдела продаж. В текущем примере, отедл продаж состоит из трех отделов: 474, 475, 486. 
5. В строке 108 необходимо указать ID воронки сделок, из которой необходимо делать подсчет сделок. 
6. Открыть в браузере https://yourdomain.com/path/report.html 
7. Указать интервал сбора отчета
8. Дождаться загрузки данных.


**Переменные передаваемые в POST запросе:**

yourdomain.com - адрес сайта, на котором размещены скрипты report.php, report.html и auth.php с поддержкой SSL.

path - путь до скрипта.

### Ссылки на документацию 1С-Битрикс 

<details><summary>Развернуть список</summary>

1. Как создать Webhook https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=99&LESSON_ID=8581&LESSON_PATH=8771.8583.8581

</details>

